---
const { post, variant = "small" } = Astro.props;

function timeAgo(utc) {
  const diff = Math.max(1, Math.floor(Date.now()/1000 - utc));
  const h = Math.floor(diff / 3600);
  if (h < 24) return `${h}h ago`;
  const d = Math.floor(h / 24);
  return `${d}d ago`;
}

const sizes = {
  small: "text-[18px] leading-[1.15]",
  medium: "text-[22px] leading-[1.12]"
};
const titleClass = sizes[variant] || sizes.small;
---
<a
  href={post.url}
  target="_blank"
  rel="noreferrer"
  class="group block mx-4 rounded-3xl border border-[rgb(var(--stroke))] bg-[rgb(var(--card))]
         overflow-hidden transition-transform active:scale-[0.99]"
>
  <div class="px-5 py-5">
    <div class="flex items-start gap-4">
      {post.thumb ? (
        <img
          src={post.thumb}
          alt=""
          class="h-16 w-16 rounded-2xl object-cover border border-[rgb(var(--stroke))] shrink-0"
          loading="lazy"
        />
      ) : (
        <div class="h-16 w-16 rounded-2xl border border-[rgb(var(--stroke))] shrink-0
                    bg-gradient-to-br from-white/5 to-white/0"></div>
      )}

      <div class="min-w-0">
        <h3 class={"font-display tracking-tight " + titleClass}>
          {post.title}
        </h3>

        <div class="mt-3 flex flex-wrap items-center gap-x-2 gap-y-1 text-[11px] text-[rgb(var(--muted))]">
          <span class="inline-flex items-center gap-2">
            <span class="h-1.5 w-1.5 rounded-full bg-[rgb(var(--accent))]"></span>
            r/{post.subreddit}
          </span>
          <span>·</span>
          <span>{timeAgo(post.createdUtc)}</span>
          {post.domain && (<>
            <span>·</span><span>{post.domain}</span>
          </>)}
        </div>
      </div>
    </div>

    <div class="mt-4 h-px w-full bg-[rgb(var(--stroke))]"></div>

    <div class="mt-3 flex items-center justify-between text-[11px] text-[rgb(var(--muted))]">
      <span>Source: Reddit</span>
      <span class="text-[rgb(var(--accent))] group-hover:underline underline-offset-4">Open →</span>
    </div>
  </div>
</a>
